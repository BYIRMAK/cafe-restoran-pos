name: Build and Release

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  SOLUTION_PATH: CafeRestaurantPOS.sln
  BUILD_CONFIGURATION: Release

permissions:
  contents: read

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1
    
    - name: Setup NuGet
      uses: nuget/setup-nuget@v1
    
    - name: Restore NuGet packages
      run: nuget restore ${{ env.SOLUTION_PATH }}
    
    - name: Build Solution
      run: msbuild ${{ env.SOLUTION_PATH }} /p:Configuration=${{ env.BUILD_CONFIGURATION }} /p:Platform="Any CPU" /p:OutputPath=bin/Release
    
    - name: Create Release Package
      run: |
        mkdir release-package
        mkdir release-package/MenuSoft-POS
        mkdir release-package/MenuSoft-LicenseManager
        
        # Copy POS files
        Copy-Item -Path "CafeRestaurantPOS/bin/Release/*" -Destination "release-package/MenuSoft-POS/" -Recurse -Force
        
        # Copy License Manager files
        Copy-Item -Path "LicenseManager/bin/Release/*" -Destination "release-package/MenuSoft-LicenseManager/" -Recurse -Force
        
        # Create README
        @"
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘          MENÃœ SOFT - CAFE RESTORAN POS SÄ°STEMÄ°             â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ“¦ PAKET Ä°Ã‡ERÄ°ÄÄ°:
        
        1ï¸âƒ£  MenuSoft-POS/
           â””â”€ CafeRestaurantPOS.exe  (Ana Uygulama)
        
        2ï¸âƒ£  MenuSoft-LicenseManager/
           â””â”€ LicenseManager.exe     (Lisans YÃ¶netimi)
        
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        ğŸš€ HIZLI BAÅLANGIÃ‡:
        
        ADIM 1: CafeRestaurantPOS.exe'yi Ã§alÄ±ÅŸtÄ±rÄ±n
        
        ADIM 2: Lisans Aktivasyonu
           â€¢ Cihaz ID'nizi kopyalayÄ±n
           â€¢ ğŸ“ 0 552 165 04 35 numaralÄ± telefonu arayÄ±n
           â€¢ Cihaz ID'nizi iletin
           â€¢ AldÄ±ÄŸÄ±nÄ±z ÃœrÃ¼n Kodu ve Lisans NumarasÄ±nÄ± girin
        
        ADIM 3: GiriÅŸ YapÄ±n
           KullanÄ±cÄ±: admin
           Åifre: admin123
        
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        ğŸ“ DESTEK VE LÄ°SANS:
        
        Telefon: 0 552 165 04 35
        Ã‡alÄ±ÅŸma Saatleri: Hafta iÃ§i 09:00-18:00
        
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        âœ¨ Ã–ZELLÄ°KLER:
        
        âœ… Modern, kullanÄ±cÄ± dostu arayÃ¼z
        âœ… Offline Ã§alÄ±ÅŸma (internet gerekmez)
        âœ… GÃ¼venli AES-256 ÅŸifreleme
        âœ… Cihaz bazlÄ± lisanslama
        âœ… SQLite veritabanÄ±
        âœ… Otomatik yedekleme
        
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        Â© 2026 MenÃ¼ Soft - TÃ¼m haklarÄ± saklÄ±dÄ±r.
        
        "@ | Out-File -FilePath "release-package/OKULIN.txt" -Encoding UTF8
      shell: pwsh
    
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: MenuSoft-POS-Complete
        path: release-package/
    
    - name: Create ZIP files
      run: |
        Compress-Archive -Path "release-package/MenuSoft-POS/*" -DestinationPath "MenuSoft-POS.zip"
        Compress-Archive -Path "release-package/MenuSoft-LicenseManager/*" -DestinationPath "MenuSoft-LicenseManager.zip"
        Compress-Archive -Path "release-package/*" -DestinationPath "MenuSoft-Complete-Package.zip"
      shell: pwsh
    
    - name: Upload ZIP Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ZIP-Packages
        path: |
          MenuSoft-POS.zip
          MenuSoft-LicenseManager.zip
          MenuSoft-Complete-Package.zip
